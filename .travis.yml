sudo: false
language: python
dist: xenial
cache: pip  # use caching for pip's packages to speed up builds

branches:
  only:
  - master

os: linux

python:
- "3.7"

env:
  global:
  - DISPLAY=:99.0
  - PIP_INSTALL="pip install"
  - GENERAL_EXCLUDE="--exclude-dir=tests/resources --exclude-dir=tests/ci"
  - PYTHON=python

matrix:
  include:
  - os: windows
    name: "Python3.7 on Windows"
    language: sh
    env:
      - PYTHON="C:/Python37/python.exe"
      - PIP_INSTALL="C:/Python37/python.exe -m pip install"
      - PATH=c/Python37:/c/Python37/Scripts:$PATH
      - R_PATH=C:/Ruby22/bin
      - PYTHON_VERSION="3.7.x"
      - PYTHON_ARCH="64"
#      - NODEJS_VERSION="10"
    before_install:
    - choco install python --version 3.7.6
    - $PYTHON --version
    - $PYTHON -m ensurepip
    - $PIP_INSTALL --upgrade pip wheel
    script:
    - $PYTHON -m nose tests.modules # -v --exclude-dir=tests/resources --exclude-dir=tests/ci -with-coverage --cover-inclusive

addons:
  firefox: latest
  chrome: stable
  apt:
    packages:
    - openjdk-8-jdk
    - mono-complete
    - python3-tk

before_install:
- mono --version

install:
- $PIP_INSTALL pyyaml==3.13
- $PIP_INSTALL -r requirements.txt
- $PIP_INSTALL -r tests/ci/requirements.txt

script:
- coverage run --source=. -m nose tests -v $GENERAL_EXCLUDE --with-timer --timer-top-n 30